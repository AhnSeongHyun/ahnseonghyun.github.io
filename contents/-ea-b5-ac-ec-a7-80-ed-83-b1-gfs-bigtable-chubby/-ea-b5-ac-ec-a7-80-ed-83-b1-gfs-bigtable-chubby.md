---
title: '[구지탱] GFS, Bigtable, Chubby'
author: 'ash84'
pub_date: '2015-07-03'
description: '**GFS(Google File System)**–'
featured_image: ''
tags: ['bigtable', 'Chubby', 'dev', 'GFS', '구글을 지탱하는 기술']
---


<div style="text-align: justify; line-height: 2;"><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">**GFS(Google File System)**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 대용량 데이터에 적합한 분산 파일시스템</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 1대의 머신에 다루기 힘든 데이터를 다루지만, 작은 데이터에는 비 적합</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 하나의 파일 = N 청크(64MB)</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 하나의 청크는 3개의 청크서버에 복제되어 저장. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 파일 접근 방식 </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 대용량 데이터의 효율적 전송에 설계 초점. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">**  
**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">**  
**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">**  
**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">**Bigtable**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– GFS를 이용하면서 작은 데이터를 효율적으로 쓸수 있게 하는 분산 스토리지. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 거대한 테이블</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 로우키, 칼럼패밀리, 타임 스탬프 구조 = 다차원 맵(Multidimensional map)</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– not use sql. 프로그래밍 방식으로 연동</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">***로컬리티(locality)**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 필요한 데이터를 한곳에 모아서 두는 것. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;">– 분산 시스템의 성능향상을 위해서는 로컬리티를 고려한 디자인 필요. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size: 12pt; font-weight: bold;">**  
**</div>**Chubby**

<div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 작은 분산 파일 시스템</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 파일시스템, 잠금 서비스(배타제어), 이벤트 통지(상태 변경시 이벤트 통지)</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 1kb 미만의 파일대상</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– chubby 5 cell -> 5 replica</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 읽기에 최적화 되어 있음. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 파일은 부분업데이트를 할수 없으면, 파일 전체를 업데이트 해야함. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**파일 잠금**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 공유 잠금   => 파일 수정 방지 </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 배타적 잠금  => 안전한 파일 수정</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**외부 리소스 잠금 **</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**시퀀서 **</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 클라이언트의 요청 유효성 판별 데이터</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**failover**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 마스터 정지시, 다른 replica가 마스터로 전환.</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 마스터 전환 사이의 시간으로 타임아웃 발생 가능성 있음. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**이벤트**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 파일 생성 또는 업데이트시, 이벤트 발생. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 각 서버들은 시동시, 특정 디렉토리에 파일을 만들어서 자신의 주소 기록. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 마스터는 그 디렉토리를 통해서 서버 시작/종료를 감시 </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 역으로 서버가 마스터를 감시 할수도 있음. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**캐쉬 **</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– chubby 파일을 읽으면, 그 내용을 캐쉬해서 클라이언트에서 다시 요청시, 해당 데이터 전송. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 파일 내용 업데이트시, chubby는 모든 캐쉬를 파기(오래된 캐쉬의 사용 제거)</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**마스터 선출 기법**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 다양한 고장 발생이 있지만 마스터 선발 기준은 하나. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 마스터는 절반 이상의 레플리카가 연결되어 있는 장소에서 나타난다. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 기본 5개의 레플리카로 구성되기 때문에 정상작동을 위해서는 3개이상이 연결된 상태여야 한다. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">*** 컨센서스 알고리즘(Consensus algorithm) – Paxos**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 가장 높은 번호를 선택하고, 합의를 이끌어 내는.. ([http://wn.com/paxos_algorithm](http://wn.com/paxos_algorithm))</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;"></div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">**마스터리스(master lease)**</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 일정한 시간으로 paxos의 제안과 약속을 생략하고 수락에서부터 시작</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 마스터가 주도하지만, 과반수 이상의 합의가 있어야 한다. </div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 마스터리스는 마스터가 정상 동작하는한 계속 갱신.</div><div style="color: rgb(0, 0, 0); font-family: 나눔고딕; line-height: 2; text-align: justify; font-size:12pt;">– 정리하면, 마스터리스는 마스터가 살아있을때, 다음 마스터를 제안/약속 단계없이 합의를 주도하여 다음 마스터를 선출하는 시간을 말한다.<span style="font-size: 12pt; line-height: 2; text-align: justify;">완전히 새로운 선출은 마스터가 정지되어 리스가 갱신되지 않으면, 마스터가 없는 상태가 발생되는데, 그때 동작하여, 새로운 마스터를 선출한다. </span></div></div>

